<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>电商数仓配置器</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- 自定义标题栏 -->
  <div class="titlebar">
    <div class="titlebar-drag">
      <div class="titlebar-icon">⚡</div>
      <div class="titlebar-title">电商数仓配置器</div>
    </div>
    <div class="titlebar-actions">
      <button class="titlebar-action-btn" onclick="showDbConfig()" title="数据库配置">
        <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
          <ellipse cx="7" cy="3" rx="5" ry="2" stroke="currentColor" stroke-width="1.5" fill="none"/>
          <path d="M2 3v8c0 1.1 2.2 2 5 2s5-.9 5-2V3" stroke="currentColor" stroke-width="1.5" fill="none"/>
          <path d="M2 7c0 1.1 2.2 2 5 2s5-.9 5-2" stroke="currentColor" stroke-width="1.5" fill="none"/>
        </svg>
      </button>
      <button class="titlebar-action-btn" onclick="showClearDialog()" title="清空数据">
        <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
          <path d="M2 4h10M5 4V3a1 1 0 011-1h2a1 1 0 011 1v1M3 4v8a1 1 0 001 1h6a1 1 0 001-1V4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
      </button>
      <div class="db-status" id="db-status" onclick="showDbConfig()" title="点击配置数据库">
        <span class="db-status-dot" id="db-status-dot"></span>
        <span class="db-status-text" id="db-status-text">未连接</span>
      </div>
    </div>
    <div class="titlebar-controls">
      <button class="titlebar-button" id="minimize-btn" title="最小化">
        <svg width="12" height="12" viewBox="0 0 12 12">
          <rect x="0" y="5" width="12" height="2" fill="currentColor"/>
        </svg>
      </button>
      <button class="titlebar-button" id="maximize-btn" title="最大化">
        <svg width="12" height="12" viewBox="0 0 12 12">
          <rect x="0" y="0" width="12" height="12" fill="none" stroke="currentColor" stroke-width="1.5"/>
        </svg>
      </button>
      <button class="titlebar-button titlebar-close" id="close-btn" title="关闭">
        <svg width="12" height="12" viewBox="0 0 12 12">
          <path d="M1 1 L11 11 M11 1 L1 11" stroke="currentColor" stroke-width="1.5"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- 应用容器 -->
  <div class="app-container">

  <!-- 主内容区 -->
  <main class="main-content">
    <!-- 步骤卡片容器 -->
    <div class="steps-container">
      <!-- 步骤 1: ODS -->
      <div class="step-card" data-step="0">
        <div class="step-bar" style="background: #48bb78;"></div>
        <div class="step-content">
          <div class="step-header">
            <div class="step-badge" style="background: #48bb78;">1</div>
            <div class="step-info">
              <h3 class="step-title">生成ODS层（原始数据层）</h3>
              <p class="step-desc">生成或导入原始业务数据，自动加载到数据库</p>
            </div>
          </div>
          <div class="step-divider"></div>
          <div class="sql-info" id="sql-info-0" style="display: none;">
            <div class="sql-header">
              <span class="sql-title">📊 数据表信息</span>
              <button class="btn-icon" onclick="toggleSql(0)" title="收起">
                <svg width="14" height="14" viewBox="0 0 14 14">
                  <path d="M2 5 L7 10 L12 5" stroke="currentColor" stroke-width="2" fill="none"/>
                </svg>
              </button>
            </div>
            <div class="sql-content" id="sql-content-0"></div>
          </div>
          <div class="step-actions">
            <button class="btn btn-primary" style="background: #48bb78;" onclick="showOdsConfig()" id="exec-btn-0">
              ▶ 执行
            </button>
            <button class="btn btn-danger" onclick="stopProcess(0)" id="stop-btn-0" style="display: none;">
              ⏹ 停止
            </button>
            <button class="btn btn-secondary" onclick="previewData('ods', 0)">
              👁 预览
            </button>
            <button class="btn btn-secondary" onclick="showSqlInfo(0)" id="sql-btn-0" style="display: none;">
              📋 查看SQL
            </button>
            <span class="step-status" id="status-0">⚪ 未执行</span>
            <span class="step-estimate" id="estimate-0" style="display: none;"></span>
          </div>
          <div class="step-progress" id="step-progress-0" style="display: none;">
            <div class="progress-log" id="progress-log-0"></div>
          </div>
        </div>
      </div>

      <!-- 步骤 2: DWD -->
      <div class="step-card" data-step="1">
        <div class="step-bar" style="background: #667eea;"></div>
        <div class="step-content">
          <div class="step-header">
            <div class="step-badge" style="background: #667eea;">2</div>
            <div class="step-info">
              <h3 class="step-title">生成DWD层（明细数据层）</h3>
              <p class="step-desc">在数据库中通过SQL转换，构建事实表和维度表</p>
            </div>
          </div>
          <div class="step-divider"></div>
          <div class="sql-info" id="sql-info-1" style="display: none;">
            <div class="sql-header">
              <span class="sql-title">📊 数据表信息</span>
              <button class="btn-icon" onclick="toggleSql(1)" title="收起">
                <svg width="14" height="14" viewBox="0 0 14 14">
                  <path d="M2 5 L7 10 L12 5" stroke="currentColor" stroke-width="2" fill="none"/>
                </svg>
              </button>
            </div>
            <div class="sql-content" id="sql-content-1"></div>
          </div>
          <div class="step-actions">
            <button class="btn btn-primary" style="background: #667eea;" onclick="generateDwd()" id="exec-btn-1">
              ▶ 执行
            </button>
            <button class="btn btn-danger" onclick="stopProcess(1)" id="stop-btn-1" style="display: none;">
              ⏹ 停止
            </button>
            <button class="btn btn-secondary" onclick="previewData('dwd', 1)">
              👁 预览
            </button>
            <button class="btn btn-secondary" onclick="showSqlInfo(1)" id="sql-btn-1" style="display: none;">
              📋 查看SQL
            </button>
            <span class="step-status" id="status-1">⚪ 未执行</span>
            <span class="step-estimate" id="estimate-1" style="display: none;"></span>
          </div>
          <div class="step-progress" id="step-progress-1" style="display: none;">
            <div class="progress-log" id="progress-log-1"></div>
          </div>
        </div>
      </div>

      <!-- 步骤 3: DWS -->
      <div class="step-card" data-step="2">
        <div class="step-bar" style="background: #ed8936;"></div>
        <div class="step-content">
          <div class="step-header">
            <div class="step-badge" style="background: #ed8936;">3</div>
            <div class="step-info">
              <h3 class="step-title">生成DWS层（汇总数据层）</h3>
              <p class="step-desc">在数据库中通过SQL聚合，构建业务汇总表</p>
            </div>
          </div>
          <div class="step-divider"></div>
          <div class="sql-info" id="sql-info-2" style="display: none;">
            <div class="sql-header">
              <span class="sql-title">📊 数据表信息</span>
              <button class="btn-icon" onclick="toggleSql(2)" title="收起">
                <svg width="14" height="14" viewBox="0 0 14 14">
                  <path d="M2 5 L7 10 L12 5" stroke="currentColor" stroke-width="2" fill="none"/>
                </svg>
              </button>
            </div>
            <div class="sql-content" id="sql-content-2"></div>
          </div>
          <div class="step-actions">
            <button class="btn btn-primary" style="background: #ed8936;" onclick="generateDws()" id="exec-btn-2">
              ▶ 执行
            </button>
            <button class="btn btn-danger" onclick="stopProcess(2)" id="stop-btn-2" style="display: none;">
              ⏹ 停止
            </button>
            <button class="btn btn-secondary" onclick="previewData('dws', 2)">
              👁 预览
            </button>
            <button class="btn btn-secondary" onclick="showSqlInfo(2)" id="sql-btn-2" style="display: none;">
              📋 查看SQL
            </button>
            <span class="step-status" id="status-2">⚪ 未执行</span>
            <span class="step-estimate" id="estimate-2" style="display: none;"></span>
          </div>
          <div class="step-progress" id="step-progress-2" style="display: none;">
            <div class="progress-log" id="progress-log-2"></div>
          </div>
        </div>
      </div>
    </div>

  </main>
  </div>

  <!-- 通知容器 -->
  <div id="toast-container" class="toast-container"></div>

  <!-- 进度日志对话框 -->
  <div id="progress-dialog" class="dialog-overlay" style="display: none;">
    <div class="dialog dialog-large">
      <div class="dialog-header">
        <h2 id="progress-title">执行进度</h2>
        <button class="dialog-close" onclick="closeProgressDialog()">✕</button>
      </div>
      <div class="dialog-content">
        <div class="progress-log-container">
          <div id="progress-log" class="progress-log"></div>
        </div>
      </div>
      <div class="dialog-footer">
        <button class="btn btn-primary" onclick="closeProgressDialog()">关闭</button>
      </div>
    </div>
  </div>

  <!-- 清空数据对话框 -->
  <div id="clear-dialog" class="dialog-overlay" style="display: none;">
    <div class="dialog">
      <div class="dialog-header" style="background: #dc2626;">
        <h2>⚠️ 清空数据</h2>
        <button class="dialog-close" onclick="closeDialog('clear-dialog')">✕</button>
      </div>
      <div class="dialog-content">
        <div class="warning-box">
          <div class="warning-icon">⚠️</div>
          <div class="warning-text">
            <strong>警告：此操作不可恢复！</strong>
            <p>请选择要清空的数据范围</p>
          </div>
        </div>
        <div class="config-section">
          <h3>清空范围</h3>
          <div class="platform-item">
            <input type="radio" id="clear-all" name="clear-type" value="all" checked>
            <label for="clear-all">全部清空（本地文件 + 数据库表）</label>
          </div>
          <div class="platform-item">
            <input type="radio" id="clear-local" name="clear-type" value="local">
            <label for="clear-local">仅清空本地CSV文件</label>
          </div>
          <div class="platform-item">
            <input type="radio" id="clear-db" name="clear-type" value="database">
            <label for="clear-db">仅清空数据库表</label>
          </div>
        </div>
      </div>
      <div class="dialog-footer">
        <button class="btn btn-secondary" onclick="closeDialog('clear-dialog')">取消</button>
        <button class="btn btn-danger" onclick="confirmClear()">🗑 确认清空</button>
      </div>
    </div>
  </div>

  <!-- 数据库配置对话框 -->
  <div id="db-config-dialog" class="dialog-overlay" style="display: none;">
    <div class="dialog">
      <div class="dialog-header" style="background: #667eea;">
        <h2>🗄️ 数据库配置</h2>
        <button class="dialog-close" onclick="closeDialog('db-config-dialog')">✕</button>
      </div>
      <div class="dialog-content">
        <div class="config-section">
          <h3>连接信息</h3>
          <div class="input-group">
            <label>主机地址</label>
            <input type="text" id="global-db-host" value="localhost" />
          </div>
          <div class="data-config-grid">
            <div class="input-group">
              <label>端口</label>
              <input type="number" id="global-db-port" value="3306" />
            </div>
            <div class="input-group">
              <label>数据库名</label>
              <input type="text" id="global-db-name" value="datas" />
            </div>
          </div>
          <div class="data-config-grid">
            <div class="input-group">
              <label>用户名</label>
              <input type="text" id="global-db-user" value="root" />
            </div>
            <div class="input-group">
              <label>密码</label>
              <input type="password" id="global-db-password" value="" />
            </div>
          </div>
        </div>
      </div>
      <div class="dialog-footer">
        <button class="btn btn-secondary" onclick="closeDialog('db-config-dialog')">取消</button>
        <button class="btn btn-primary" style="background: #667eea;" onclick="saveDbConfig()">✓ 保存配置</button>
      </div>
    </div>
  </div>

  <!-- 数据预览弹窗 -->
  <div id="preview-dialog" class="dialog-overlay" style="display: none;">
    <div class="dialog dialog-preview">
      <div class="dialog-header">
        <h2 id="preview-title">数据预览</h2>
        <button class="dialog-close" onclick="closeDialog('preview-dialog')">✕</button>
      </div>
      <div class="dialog-content preview-content" id="preview-content">
        <div class="loading">加载中...</div>
      </div>
    </div>
  </div>

  <!-- ODS配置对话框 -->
  <div id="ods-dialog" class="dialog-overlay" style="display: none;">
    <div class="dialog">
      <div class="dialog-header">
        <h2>选择数据来源</h2>
        <button class="dialog-close" onclick="closeDialog('ods-dialog')">✕</button>
      </div>
      <div class="dialog-content">
        <div class="option-card" onclick="showGenerateConfig()">
          <h3>🎲 生成模拟数据</h3>
          <p>自动生成随机的业务数据，适合测试和演示</p>
          <button class="btn btn-primary" style="background: #48bb78;">配置并生成 →</button>
        </div>
        <div class="option-card" onclick="showImportConfig()">
          <h3>📁 导入CSV文件</h3>
          <p>从现有的CSV文件导入真实业务数据</p>
          <button class="btn btn-primary" style="background: #667eea;">选择文件导入 →</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 导入配置对话框 -->
  <div id="import-dialog" class="dialog-overlay" style="display: none;">
    <div class="dialog dialog-xlarge">
      <div class="dialog-header">
        <h2>导入数据配置</h2>
        <button class="dialog-close" onclick="closeDialog('import-dialog')">✕</button>
      </div>
      <div class="dialog-content">
        <div class="import-section">
          <h3>📋 字段要求配置</h3>
          <p class="section-desc">配置每个表的字段要求，系统将根据配置验证导入的数据</p>
          <div class="field-actions">
            <button class="btn btn-secondary" onclick="resetFields()">🔄 重置为默认</button>
            <button class="btn btn-primary" style="background: #4299e1;" onclick="downloadTemplates()">⬇ 下载模板文件</button>
          </div>
          <div id="field-requirements" class="field-requirements"></div>
        </div>
        
        <div class="import-section">
          <h3>📁 选择导入文件</h3>
          <p class="section-desc">请选择符合字段要求的CSV文件（支持多选）</p>
          <input type="file" id="import-files" accept=".csv" multiple style="display: none;" onchange="handleFileSelect(event)" />
          <button class="btn btn-primary" style="background: #48bb78;" onclick="selectImportFiles()">📂 选择文件</button>
          <div id="selected-files" class="selected-files">
            <div class="no-files">未选择文件</div>
          </div>
        </div>
      </div>
      <div class="dialog-footer">
        <button class="btn btn-secondary" onclick="closeDialog('import-dialog')">取消</button>
        <button class="btn btn-primary" style="background: #48bb78;" onclick="startImport()">✓ 开始导入</button>
      </div>
    </div>
  </div>

  <!-- 生成配置对话框 -->
  <div id="generate-dialog" class="dialog-overlay" style="display: none;">
    <div class="dialog dialog-large">
      <div class="dialog-header">
        <h2>生成模拟数据配置</h2>
        <button class="dialog-close" onclick="closeDialog('generate-dialog')">✕</button>
      </div>
      <div class="dialog-content">
        <div class="config-section">
          <h3>主营类目选择</h3>
          <p class="section-desc">选择店铺的主营业务类目，将生成相应的商品数据</p>
          <div class="category-selector">
            <div class="category-item">
              <input type="radio" id="cat-bicycle" name="main-category" value="bicycle" checked>
              <label for="cat-bicycle">
                <span class="category-icon">🚴</span>
                <span class="category-name">自行车电商</span>
                <span class="category-desc">整车、骑行装备</span>
              </label>
            </div>
            <div class="category-item">
              <input type="radio" id="cat-clothing" name="main-category" value="clothing">
              <label for="cat-clothing">
                <span class="category-icon">👕</span>
                <span class="category-name">服装电商</span>
                <span class="category-desc">男装、女装、童装</span>
              </label>
            </div>
            <div class="category-item">
              <input type="radio" id="cat-electronics" name="main-category" value="electronics">
              <label for="cat-electronics">
                <span class="category-icon">📱</span>
                <span class="category-name">数码电商</span>
                <span class="category-desc">手机、电脑、配件</span>
              </label>
            </div>
            <div class="category-item">
              <input type="radio" id="cat-food" name="main-category" value="food">
              <label for="cat-food">
                <span class="category-icon">🍎</span>
                <span class="category-name">食品电商</span>
                <span class="category-desc">零食、生鲜、饮料</span>
              </label>
            </div>
            <div class="category-item">
              <input type="radio" id="cat-beauty" name="main-category" value="beauty">
              <label for="cat-beauty">
                <span class="category-icon">💄</span>
                <span class="category-name">美妆电商</span>
                <span class="category-desc">护肤、彩妆、个护</span>
              </label>
            </div>
            <div class="category-item">
              <input type="radio" id="cat-home" name="main-category" value="home">
              <label for="cat-home">
                <span class="category-icon">🏠</span>
                <span class="category-name">家居电商</span>
                <span class="category-desc">家具、家纺、装饰</span>
              </label>
            </div>
          </div>
        </div>
        <div class="config-section">
          <h3>平台与店铺配置</h3>
          <p class="section-desc">选择平台并配置每个平台的店铺数量和名称</p>
          <div id="platform-list" class="platform-list"></div>
        </div>
        <div class="config-section">
          <h3>数据量设置</h3>
          <div class="data-config-grid">
            <div class="input-group">
              <label>用户数量</label>
              <input type="number" id="num-users" value="3000" min="100" max="50000" onchange="updateGenerateEstimate()" />
            </div>
            <div class="input-group">
              <label>订单数量</label>
              <input type="number" id="num-orders" value="20000" min="100" max="100000" onchange="updateGenerateEstimate()" />
            </div>
          </div>

          <div class="estimate-info" id="generate-estimate-info">
            <span class="estimate-icon">⏱</span>
            <span class="estimate-text">预计耗时：<strong id="generate-estimate-time">30秒</strong></span>
          </div>
        </div>
      </div>
      <div class="dialog-footer">
        <button class="btn btn-secondary" onclick="closeDialog('generate-dialog')">取消</button>
        <button class="btn btn-primary" style="background: #48bb78;" onclick="startGenerate()">✓ 开始生成</button>
      </div>
    </div>
  </div>

  <script src="renderer.js"></script>
</body>
</html>
